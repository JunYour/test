<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‰∫∫ËÑ∏ËØÜÂà´</title>
  <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Helvetica Neue", Arial, sans-serif;
      background: #f5f5f5;
      min-height: 100vh;
    }

    .status-bar {
      background: white;
      padding: 8px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
    }

    .signal-icons {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .battery {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .header {
      background: white;
      padding: 16px;
      display: flex;
      align-items: center;
      box-shadow: 0 1px 0 rgba(0, 0, 0, 0.05);
    }

    .back-btn {
      font-size: 28px;
      color: #999;
      cursor: pointer;
      line-height: 1;
      margin-right: 16px;
      font-weight: 300;
    }

    .header-title {
      font-size: 18px;
      font-weight: 400;
      color: #333;
    }

    .container {
      padding: 0;
      background: white;
    }

    .video-section {
      background: white;
      padding: 24px 16px;
    }

    .video-container {
      position: relative;
      width: 100%;
      aspect-ratio: 9/10;
      border-radius: 0;
      overflow: hidden;
      background: #f8f8f8;
      margin-bottom: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .scan-frame {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 60%;
      aspect-ratio: 1;
      z-index: 2;
    }

    .corner-line {
      position: absolute;
      background: #5BC4A5;
    }

    .corner-line.tl-v {
      top: 0;
      left: 0;
      width: 3px;
      height: 60px;
    }

    .corner-line.tl-h {
      top: 0;
      left: 0;
      width: 60px;
      height: 3px;
    }

    .corner-line.tr-v {
      top: 0;
      right: 0;
      width: 3px;
      height: 60px;
    }

    .corner-line.tr-h {
      top: 0;
      right: 0;
      width: 60px;
      height: 3px;
    }

    .corner-line.bl-v {
      bottom: 0;
      left: 0;
      width: 3px;
      height: 60px;
    }

    .corner-line.bl-h {
      bottom: 0;
      left: 0;
      width: 60px;
      height: 3px;
    }

    .corner-line.br-v {
      bottom: 0;
      right: 0;
      width: 3px;
      height: 60px;
    }

    .corner-line.br-h {
      bottom: 0;
      right: 0;
      width: 60px;
      height: 3px;
    }

    .center-line {
      position: absolute;
      left: 0;
      right: 0;
      top: 50%;
      height: 2px;
      background: #5BC4A5;
      transform: translateY(-50%);
    }

    .face-placeholder {
      position: relative;
      z-index: 1;
    }

    .face-head {
      width: 120px;
      height: 100px;
      background: #F5DEB3;
      border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
      position: relative;
      margin: 0 auto;
    }

    .hair {
      width: 100px;
      height: 50px;
      background: #5F6876;
      position: absolute;
      top: -5px;
      left: 10px;
      border-radius: 50% 50% 0 0 / 100% 100% 0 0;
    }

    .hair::after {
      content: '';
      width: 60px;
      height: 40px;
      background: #5F6876;
      position: absolute;
      top: 10px;
      right: -15px;
      border-radius: 0 80% 80% 0;
      transform: rotate(-20deg);
    }

    .eye {
      width: 8px;
      height: 8px;
      background: #333;
      border-radius: 50%;
      position: absolute;
      top: 48px;
    }

    .eye.left {
      left: 35px;
    }

    .eye.right {
      right: 35px;
    }

    .nose {
      width: 20px;
      height: 3px;
      background: #F5DEB3;
      border: 2px solid #E5CEB3;
      border-bottom: none;
      border-radius: 50% 50% 0 0;
      position: absolute;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
    }

    .mouth {
      width: 24px;
      height: 12px;
      border: 2px solid #333;
      border-top: none;
      border-radius: 0 0 50% 50%;
      position: absolute;
      top: 70px;
      left: 50%;
      transform: translateX(-50%);
    }

    .neck {
      width: 50px;
      height: 20px;
      background: #F5DEB3;
      position: absolute;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
    }

    .body {
      width: 80px;
      height: 60px;
      background: #B8BEC5;
      position: relative;
      margin: 20px auto 0;
      clip-path: polygon(30% 0, 70% 0, 100% 100%, 0 100%);
    }

    .collar {
      width: 40px;
      height: 30px;
      background: white;
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      clip-path: polygon(20% 0, 80% 0, 100% 100%, 0 100%);
    }

    #video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: none;
      position: absolute;
      top: 0;
      left: 0;
    }

    #canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
    }

    .video-overlay {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px 24px;
      border-radius: 24px;
      font-size: 16px;
      font-weight: 500;
      z-index: 10;
      display: none;
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .video-overlay.match {
      background: rgba(46, 125, 50, 0.95);
      color: white;
      display: block;
    }

    .video-overlay.no-match {
      background: rgba(198, 40, 40, 0.95);
      color: white;
      display: block;
    }

    .video-overlay.checking {
      background: rgba(21, 101, 192, 0.95);
      color: white;
      display: block;
    }

    .divider {
      height: 1px;
      background: #e5e5e5;
      margin: 0 16px 24px;
    }

    .instructions {
      padding: 0 16px 32px;
      background: white;
    }

    .instruction-item {
      display: flex;
      align-items: flex-start;
      margin-bottom: 12px;
      font-size: 15px;
      color: #666;
      line-height: 1.6;
    }

    .instruction-item:last-child {
      margin-bottom: 0;
    }

    .tips-section {
      display: flex;
      justify-content: space-around;
      padding: 0 16px 32px;
      background: white;
    }

    .tip-item {
      text-align: center;
      flex: 1;
      position: relative;
    }

    .tip-icon-wrapper {
      width: 72px;
      height: 72px;
      margin: 0 auto 10px;
      position: relative;
    }

    .tip-icon {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .tip-icon svg {
      width: 48px;
      height: 48px;
    }

    .tip-check {
      position: absolute;
      bottom: 2px;
      right: 2px;
      width: 24px;
      height: 24px;
      background: #5BC4A5;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 16px;
      font-weight: bold;
    }

    .tip-label {
      font-size: 14px;
      color: #333;
    }

    .button-section {
      padding: 0 16px 32px;
      background: white;
    }

    .start-button {
      width: 100%;
      background: #5BC4A5;
      color: white;
      border: none;
      padding: 16px;
      border-radius: 24px;
      font-size: 17px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
    }

    .start-button:active {
      opacity: 0.8;
      transform: scale(0.98);
    }

    .start-button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .start-button.active {
      background: #f44336;
    }

    .match-result {
      margin-top: 16px;
      padding: 14px;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 500;
      text-align: center;
      display: none;
    }

    .match {
      background: #E8F5E9;
      color: #2E7D32;
      display: block;
    }

    .no-match {
      background: #FFEBEE;
      color: #C62828;
      display: block;
    }

    .checking {
      background: #E3F2FD;
      color: #1565C0;
      display: block;
    }

    .status-message {
      text-align: center;
      padding: 12px 16px;
      font-size: 14px;
      background: #FFF3E0;
      color: #E65100;
    }

    .status-message.ready {
      background: #E8F5E9;
      color: #2E7D32;
    }

    .status-message.error {
      background: #FFEBEE;
      color: #C62828;
    }
  </style>
</head>

<body>
  <div class="status-bar">
    <div class="signal-icons">
      <span style="font-size: 12px;">‚ö´‚ö´‚ö´‚ö´ ‚óÄ</span>
    </div>
    <div style="font-weight: 500;">9:41 AM</div>
    <div class="battery">
      <span style="font-size: 12px;">100%</span>
      <span style="font-size: 16px;">üîã</span>
    </div>
  </div>

  <div class="header">
    <span class="back-btn">‚Äπ</span>
    <span class="header-title">‰∫∫ËÑ∏ËØÜÂà´</span>
  </div>

  <div id="statusMessage" class="status-message">Ê≠£Âú®Âä†ËΩΩÊ®°Âûã...</div>

  <div class="container">
    <div class="video-section">
      <div class="video-container">
        <div class="scan-frame">
          <div class="corner-line tl-v"></div>
          <div class="corner-line tl-h"></div>
          <div class="corner-line tr-v"></div>
          <div class="corner-line tr-h"></div>
          <div class="corner-line bl-v"></div>
          <div class="corner-line bl-h"></div>
          <div class="corner-line br-v"></div>
          <div class="corner-line br-h"></div>
          <div class="center-line"></div>
        </div>

        <div class="face-placeholder">
          <div class="face-head">
            <div class="hair"></div>
            <div class="eye left"></div>
            <div class="eye right"></div>
            <div class="nose"></div>
            <div class="mouth"></div>
            <div class="neck"></div>
          </div>
          <div class="body">
            <div class="collar"></div>
          </div>
        </div>

        <video id="video" autoplay muted playsinline></video>
        <canvas id="canvas"></canvas>
        <div id="videoOverlay" class="video-overlay"></div>
      </div>
    </div>

    <div class="divider"></div>

    <div class="instructions">
      <div class="instruction-item">
        1.ËØ∑Á°ÆËÆ§Áî±Êú¨‰∫∫‰∫≤Ëá™Êìç‰ΩúÔºõ
      </div>
      <div class="instruction-item">
        2.ËØ∑ËÆ≤ËÑ∏ÁΩÆ‰∫éÊèêÁ§∫Ê°ÜÂÜÖÔºåÂπ∂ÊåâÊèêÁ§∫ÂÆåÊàêÂä®‰Ωú„ÄÇ
      </div>
    </div>

    <div class="tips-section">
      <div class="tip-item">
        <div class="tip-icon-wrapper">
          <div class="tip-icon">
            <svg viewBox="0 0 48 48" fill="none">
              <rect x="8" y="4" width="32" height="40" rx="3" fill="#E0E0E0" />
              <rect x="10" y="6" width="28" height="36" rx="2" fill="white" />
              <circle cx="24" cy="10" r="1.5" fill="#999" />
              <path d="M20 28 L24 32 L28 28" stroke="#5BC4A5" stroke-width="2" stroke-linecap="round" fill="none" />
              <circle cx="20" cy="22" r="2" fill="#666" />
              <circle cx="28" cy="22" r="2" fill="#666" />
            </svg>
          </div>
          <div class="tip-check">‚úì</div>
        </div>
        <div class="tip-label">Ê≠£ÂØπÊâãÊú∫</div>
      </div>

      <div class="tip-item">
        <div class="tip-icon-wrapper">
          <div class="tip-icon">
            <svg viewBox="0 0 48 48" fill="none">
              <rect x="10" y="8" width="28" height="32" rx="2" fill="#FFF9C4" />
              <circle cx="24" cy="24" r="8" fill="#FFEB3B" />
              <path
                d="M24 10 L24 6 M24 42 L24 38 M38 24 L42 24 M6 24 L10 24 M34.5 13.5 L37.5 10.5 M10.5 37.5 L13.5 34.5 M34.5 34.5 L37.5 37.5 M10.5 10.5 L13.5 13.5"
                stroke="#FDD835" stroke-width="2" stroke-linecap="round" />
            </svg>
          </div>
          <div class="tip-check">‚úì</div>
        </div>
        <div class="tip-label">ÂÖâÁ∫øÂÖÖË∂≥</div>
      </div>

      <div class="tip-item">
        <div class="tip-icon-wrapper">
          <div class="tip-icon">
            <svg viewBox="0 0 48 48" fill="none">
              <circle cx="24" cy="20" r="12" fill="#FFE0B2" />
              <circle cx="20" cy="18" r="2" fill="#333" />
              <circle cx="28" cy="18" r="2" fill="#333" />
              <path d="M20 24 Q24 26 28 24" stroke="#333" stroke-width="1.5" fill="none" />
              <path d="M24 32 L24 36" stroke="#999" stroke-width="2" stroke-linecap="round" />
              <path d="M20 36 L28 36" stroke="#999" stroke-width="2" stroke-linecap="round" />
              <path d="M22 36 L22 40 M26 36 L26 40" stroke="#999" stroke-width="1.5" stroke-linecap="round" />
            </svg>
          </div>
          <div class="tip-check">‚úì</div>
        </div>
        <div class="tip-label">ÊîæÊÖ¢Âä®‰Ωú</div>
      </div>
    </div>

    <div class="button-section">
      <button id="startBtn" class="start-button" disabled>ÂºÄÂßãÊ£ÄÊµã</button>
      <div id="matchResult" class="match-result"></div>
    </div>
  </div>

  <img id="referenceImg" style="display: none;" crossorigin="anonymous">

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const referenceImg = document.getElementById('referenceImg');
    const statusMessage = document.getElementById('statusMessage');
    const startBtn = document.getElementById('startBtn');
    const matchResult = document.getElementById('matchResult');
    const videoOverlay = document.getElementById('videoOverlay');

    let stream = null;
    let isDetecting = false;
    let referenceFaceDescriptor = null;

    const REFERENCE_IMAGE_URL = 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=400&fit=crop';

    async function loadModels() {
      const MODEL_URL = 'https://cdn.jsdelivr.net/npm/@vladmandic/face-api@1.7.12/model/';

      try {
        statusMessage.textContent = 'Ê≠£Âú®Âä†ËΩΩ‰∫∫ËÑ∏Ê£ÄÊµãÊ®°Âûã...';
        await faceapi.nets.ssdMobilenetv1.loadFromUri(MODEL_URL);

        statusMessage.textContent = 'Ê≠£Âú®Âä†ËΩΩÁâπÂæÅÁÇπÊ®°Âûã...';
        await faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL);

        statusMessage.textContent = 'Ê≠£Âú®Âä†ËΩΩ‰∫∫ËÑ∏ËØÜÂà´Ê®°Âûã...';
        await faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL);

        statusMessage.textContent = 'Ê≠£Âú®Âä†ËΩΩÂèÇËÄÉ‰∫∫ËÑ∏...';
        await loadReferenceImage();

        statusMessage.className = 'status-message ready';
        statusMessage.textContent = '‚úì ÂáÜÂ§áÂ∞±Áª™ÔºåÁÇπÂáªÊåâÈíÆÂºÄÂßãÊ£ÄÊµã';
        startBtn.disabled = false;
      } catch (error) {
        statusMessage.className = 'status-message error';
        statusMessage.textContent = '‚úó ÂàùÂßãÂåñÂ§±Ë¥•: ' + error.message;
        console.error('Error loading models:', error);
      }
    }

    async function loadReferenceImage() {
      return new Promise(async (resolve, reject) => {
        referenceImg.src = REFERENCE_IMAGE_URL;

        referenceImg.onload = async () => {
          try {
            await referenceImg.decode();

            const detection = await faceapi
              .detectSingleFace(referenceImg)
              .withFaceLandmarks()
              .withFaceDescriptor();

            if (detection) {
              referenceFaceDescriptor = detection.descriptor;
              console.log('ÂèÇËÄÉ‰∫∫ËÑ∏ÁâπÂæÅÂ∑≤ÊèêÂèñ');
              resolve();
            } else {
              reject(new Error('ÂèÇËÄÉÂõæÁâá‰∏≠Êú™Ê£ÄÊµãÂà∞‰∫∫ËÑ∏'));
            }
          } catch (error) {
            reject(error);
          }
        };

        referenceImg.onerror = () => {
          reject(new Error('ÂèÇËÄÉÂõæÁâáÂä†ËΩΩÂ§±Ë¥•'));
        };
      });
    }

    async function startVideo() {
      try {
        stream = await navigator.mediaDevices.getUserMedia({
          video: {
            width: { ideal: 640 },
            height: { ideal: 480 },
            facingMode: 'user'
          }
        });
        video.srcObject = stream;

        await new Promise((resolve) => {
          video.onloadedmetadata = () => {
            video.play();
            resolve();
          };
        });

        await new Promise((resolve) => {
          video.oncanplay = () => {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            resolve();
          };
        });

        video.style.display = 'block';
        canvas.style.display = 'block';
        document.querySelector('.face-placeholder').style.display = 'none';

        startBtn.textContent = 'ÂÅúÊ≠¢Ê£ÄÊµã';
        startBtn.classList.add('active');

        isDetecting = true;
        detectFaces();
      } catch (error) {
        statusMessage.className = 'status-message error';
        statusMessage.textContent = '‚úó Êó†Ê≥ïËÆøÈóÆÊëÑÂÉèÂ§¥';
        console.error('Error accessing webcam:', error);
      }
    }

    function stopVideo() {
      isDetecting = false;
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
        video.srcObject = null;
      }

      video.style.display = 'none';
      canvas.style.display = 'none';
      videoOverlay.style.display = 'none';
      document.querySelector('.face-placeholder').style.display = 'block';

      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      startBtn.textContent = 'ÂºÄÂßãÊ£ÄÊµã';
      startBtn.classList.remove('active');

      matchResult.style.display = 'none';
    }

    async function detectFaces() {
      if (!isDetecting) return;

      if (video.readyState !== video.HAVE_ENOUGH_DATA) {
        requestAnimationFrame(detectFaces);
        return;
      }

      try {
        const detections = await faceapi
          .detectAllFaces(video)
          .withFaceLandmarks()
          .withFaceDescriptors();

        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        if (detections.length > 0) {
          const resizedDetections = faceapi.resizeResults(detections, {
            width: canvas.width + 30,
            height: canvas.height
          });

          faceapi.draw.drawFaceLandmarks(canvas, resizedDetections);

          let bestMatch = null;
          let bestDistance = 1;

          resizedDetections.forEach(detection => {
            const distance = faceapi.euclideanDistance(
              referenceFaceDescriptor,
              detection.descriptor
            );

            if (distance < bestDistance) {
              bestDistance = distance;
              bestMatch = detection;
            }
          });

          if (bestDistance < 0.6) {
            const similarity = ((1 - bestDistance) * 100).toFixed(1);
            videoOverlay.className = 'video-overlay match';
            videoOverlay.textContent = `‚úì ÂåπÈÖçÊàêÂäüÔºÅÁõ∏‰ººÂ∫¶: ${similarity}%`;
          } else {
            videoOverlay.className = 'video-overlay no-match';
            videoOverlay.textContent = `‚úó ‰∫∫ËÑ∏‰∏çÂåπÈÖç`;
          }
        } else {
          videoOverlay.className = 'video-overlay checking';
          videoOverlay.textContent = `Êú™Ê£ÄÊµãÂà∞‰∫∫ËÑ∏ÔºåËØ∑Ë∞ÉÊï¥‰ΩçÁΩÆ`;
        }
      } catch (error) {
        console.error('Detection error:', error);
      }

      requestAnimationFrame(detectFaces);
    }

    startBtn.addEventListener('click', () => {
      if (!isDetecting) {
        startVideo();
      } else {
        stopVideo();
      }
    });

    function waitForFaceAPI() {
      if (typeof faceapi !== 'undefined') {
        loadModels();
      } else {
        setTimeout(waitForFaceAPI, 200);
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', waitForFaceAPI);
    } else {
      waitForFaceAPI();
    }
  </script>
</body>

</html>
